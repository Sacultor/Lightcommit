# ERC-8004 Trustless Agent ç³»ç»Ÿ

## æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†åŸºäº ERC-8004 æ ‡å‡†çš„å»ä¸­å¿ƒåŒ– GitHub è´¡çŒ®è¯„ä¼°ä¸é“¾ä¸Šå‡­è¯ç³»ç»Ÿï¼Œé€šè¿‡æ™ºèƒ½åˆçº¦è‡ªåŠ¨åŒ–è¯„ä¼°å¼€å‘è€…è´¡çŒ®å¹¶é“¸é€ ä¸å¯ç¯¡æ”¹çš„é“¾ä¸Šå£°èª‰å‡­è¯ã€‚

## æ ¸å¿ƒç‰¹æ€§

### âœ… å·²å®ç°

- **èº«ä»½æ³¨å†Œè¡¨**ï¼šGitHub ç”¨æˆ·ä¸é’±åŒ…åœ°å€ç»‘å®š
- **å£°èª‰æ³¨å†Œè¡¨**ï¼šEIP-712 ç­¾åçš„é“¾ä¸Šè¯„åˆ†åé¦ˆç³»ç»Ÿ
- **éªŒè¯æ³¨å†Œè¡¨**ï¼šåŸºäºé˜ˆå€¼çš„è‡ªåŠ¨ NFT é“¸é€ å†³ç­–
- **ERC-721 å‡­è¯**ï¼šä¸å¯ç¯¡æ”¹çš„è´¡çŒ®è¯æ˜ NFT
- **å¤šç»´åº¦è¯„åˆ†**ï¼šCommit Messageã€ä»£ç è§„æ¨¡ã€æ–‡ä»¶å½±å“ç­‰
- **IPFS é›†æˆ**ï¼šå…ƒæ•°æ®å»ä¸­å¿ƒåŒ–å­˜å‚¨
- **äº‹ä»¶é©±åŠ¨**ï¼šå®æ—¶é“¾ä¸Šäº‹ä»¶ç›‘å¬

### ğŸ”„ è¿›è¡Œä¸­

- Chainlink Functions é›†æˆ
- æ‰¹é‡å¤„ç†ä¼˜åŒ–
- å‰ç«¯ UI ç»„ä»¶
- ç§»åŠ¨ç«¯æ”¯æŒ

### ğŸ“‹ è®¡åˆ’ä¸­

- DAO æ²»ç†æ¨¡å—
- å¤šé“¾éƒ¨ç½²ï¼ˆPolygonã€Arbitrumï¼‰
- zk éšç§è¯æ˜
- EAS é›†æˆ

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
pnpm install
```

### 2. å¯åŠ¨æœ¬åœ°é“¾
```bash
cd hardhat
npx hardhat node
```

### 3. éƒ¨ç½²åˆçº¦
```bash
npx hardhat run scripts/deploy-erc8004.ts --network localhost
```

### 4. é…ç½®å‰ç«¯
```bash
cd frontend
cp .env.erc8004.example .env
```

ç¼–è¾‘ `.env`ï¼Œå¡«å…¥éƒ¨ç½²çš„åˆçº¦åœ°å€ã€‚

### 5. å¯åŠ¨å‰ç«¯
```bash
pnpm dev
```

è®¿é—® http://localhost:3000

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Webhook â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯„åˆ†æœåŠ¡ (API) â”‚
â”‚  - å¤šç»´åº¦åˆ†æ   â”‚
â”‚  - EIP-712ç­¾å  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReputationRegistry (é“¾ä¸Š)  â”‚
â”‚  - éªŒè¯ç­¾å                 â”‚
â”‚  - å­˜å‚¨è¯„åˆ†å“ˆå¸Œ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ValidationRegistry (é“¾ä¸Š)  â”‚
â”‚  - é˜ˆå€¼åˆ¤æ–­ (>= 80åˆ†)       â”‚
â”‚  - è‡ªåŠ¨è§¦å‘é“¸é€              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CommitNFT      â”‚
â”‚  (ERC-721)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åˆçº¦åœ°å€ï¼ˆæœ¬åœ°å¼€å‘ï¼‰

éƒ¨ç½²åä¼šè‡ªåŠ¨æ˜¾ç¤ºï¼Œç¤ºä¾‹ï¼š
```
AgentIdentityRegistry: 0x5FbDB2315678afecb367f032d93F642f64180aa3
ReputationRegistry: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
CommitNFT: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
ValidationRegistry: 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9
```

## æ ¸å¿ƒæµç¨‹

### 1. æ³¨å†Œèº«ä»½
```typescript
await identityRegistry.registerAgent(
  "github-username",
  "ipfs://QmAgentCard"
);
```

### 2. æäº¤è¯„åˆ†
```typescript
const { feedback, signature, metadataURI } = await fetch(
  `/api/contributions/${id}/sign`
).then(r => r.json());

await reputationRegistry.submitFeedback(
  feedback.contributor,
  feedback.repo,
  feedback.commitSha,
  feedback.score,
  feedback.feedbackHash,
  metadataURI,
  signature
);
```

### 3. è¯·æ±‚éªŒè¯
```typescript
await validationRegistry.requestValidation(
  repo,
  commitSha,
  contributor,
  metadataURI
);
```

å¦‚æœè¯„åˆ† >= 80ï¼Œè‡ªåŠ¨é“¸é€  NFTã€‚

## è¯„åˆ†ç»´åº¦

| ç»´åº¦ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| Commit Message | 25% | Conventional Commits è§„èŒƒ |
| ä»£ç è§„æ¨¡ | 20% | additions + deletions |
| æ–‡ä»¶å½±å“ | 20% | æµ‹è¯•è¦†ç›–ã€æ–‡æ¡£ç­‰ |
| åˆå¹¶ä¿¡å· | 15% | æ˜¯å¦å·²åˆå¹¶ |
| å…ƒæ•°æ®å®Œæ•´æ€§ | 20% | Issue é“¾æ¥ã€æè¿°ç­‰ |

## æ–‡æ¡£

- **[éƒ¨ç½²æŒ‡å—](./DEPLOYMENT_GUIDE.md)** - è¯¦ç»†éƒ¨ç½²æ­¥éª¤
- **[å®ç°æ–‡æ¡£](./ERC8004_IMPLEMENTATION.md)** - æŠ€æœ¯å®ç°ç»†èŠ‚
- **[ä½¿ç”¨ç¤ºä¾‹](./ERC8004_USAGE_EXAMPLES.md)** - ä»£ç ç¤ºä¾‹
- **[API å‚è€ƒ](./API_REFERENCE.md)** - API æ–‡æ¡£

## æµ‹è¯•

### è¿è¡Œå•å…ƒæµ‹è¯•
```bash
cd hardhat
npx hardhat test
```

### è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
npx hardhat test test/ERC8004.test.ts
```

### æŸ¥çœ‹è¦†ç›–ç‡
```bash
npx hardhat coverage
```

## å®‰å…¨ç‰¹æ€§

- âœ… EIP-712 ç­¾åéªŒè¯
- âœ… é˜²é‡æ”¾æ”»å‡»ï¼ˆnonce + timestampï¼‰
- âœ… è§’è‰²æƒé™æ§åˆ¶
- âœ… ç´§æ€¥æš‚åœæœºåˆ¶
- âœ… Commit å»é‡æ£€æŸ¥
- âœ… ReentrancyGuard ä¿æŠ¤

## æ€§èƒ½ä¼˜åŒ–

- **æœ€å°åŒ–é“¾ä¸Šå­˜å‚¨**ï¼šä»…å­˜å“ˆå¸Œå’ŒæŒ‡é’ˆ
- **äº‹ä»¶é©±åŠ¨**ï¼šå‡å°‘çŠ¶æ€è¯»å–
- **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡è¯„åˆ†ï¼ˆTODOï¼‰
- **Layer2 å‹å¥½**ï¼šå¯éƒ¨ç½²åˆ° Optimism/Arbitrum

## å¸¸è§é—®é¢˜

### Q: è¯„åˆ†é˜ˆå€¼å¯ä»¥è°ƒæ•´å—ï¼Ÿ
A: å¯ä»¥ï¼Œç®¡ç†å‘˜å¯è°ƒç”¨ `ValidationRegistry.setMintThreshold(newThreshold)`

### Q: IPFS ä¸Šä¼ å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥ Pinata/Web3.Storage é…ç½®ï¼Œæˆ–ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

### Q: å¦‚ä½•æ·»åŠ æ–°çš„è¯„åˆ†ç»´åº¦ï¼Ÿ
A: ä¿®æ”¹ `frontend/src/lib/services/scoring.service.ts`

### Q: æ”¯æŒå“ªäº›åŒºå—é“¾ï¼Ÿ
A: ä»»ä½• EVM å…¼å®¹é“¾ï¼ˆEthereumã€Polygonã€Arbitrumã€Optimism ç­‰ï¼‰

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªï¼š
1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤ PR
4. ç¡®ä¿æµ‹è¯•é€šè¿‡

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

- Email: 2313072@mail.nankai.edu.cn
- GitHub: https://github.com/Sacultor/Lightcommit

## è‡´è°¢

- ERC-8004 æ ‡å‡†ï¼šhttps://8004.org
- OpenZeppelin åˆçº¦åº“
- Hardhat å¼€å‘æ¡†æ¶
- Ethers.js

